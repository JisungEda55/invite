<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°°ë‹¬ ë°ëª¨ - ë¶€ì‚° ì„œë©´ì </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
    <style>
        body { font-family: 'Pretendard', sans-serif; background-color: #f1f3f5; margin: 0; }
        .yogiyo-pink { color: #FA0050; }
        .yogiyo-bg-pink { background-color: #FA0050; }
        #map { height: 320px; width: 100%; filter: grayscale(0.2) contrast(1.1); }
        .rider-emoji { font-size: 28px; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.2)); transition: all 0.5s linear; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; transition: all 0.3s ease; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .animate-slide-up { animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const DeliveryApp = () => {
            // ë¶€ì‚° ì„œë©´ì—­ ì¤‘ì‹¬ ì¢Œí‘œ: 35.158, 129.059
            const DEST_COORDS = [35.158, 129.059]; // ë„ì°©ì§€ (ì„œë©´ì—­)
            const START_COORDS = [35.153, 129.065]; // ì¶œë°œì§€ (ì „í¬ë™ ê³µì°¨)

            const [step, setStep] = useState(1);
            const [timeLeft, setTimeLeft] = useState(12 * 60);
            const [isModalOpen, setIsModalOpen] = useState(false);
            const mapRef = useRef(null);
            const riderMarkerRef = useRef(null);

            // íƒ€ì´ë¨¸ ì‘ë™
            useEffect(() => {
                const timer = setInterval(() => {
                    setTimeLeft(prev => (prev > 0 ? prev - 1 : 0));
                }, 1000);
                return () => clearInterval(timer);
            }, []);

            // ì§€ë„ ì´ˆê¸°í™” (ë¶€ì‚° ì„œë©´)
            useEffect(() => {
                if (!mapRef.current) {
                    mapRef.current = L.map('map', { 
                        zoomControl: false,
                        attributionControl: false 
                    }).setView(START_COORDS, 15);
                    
                    L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png').addTo(mapRef.current);

                    // ë„ì°©ì§€ ë§ˆì»¤ (ë‚´ ìœ„ì¹˜)
                    const homeIcon = L.divIcon({
                        html: `<div class="relative"><div class="absolute -top-2 -left-2 w-8 h-8 bg-pink-500/20 rounded-full animate-ping"></div><div class="bg-white p-1 rounded-full shadow-md border-2 border-pink-500 relative z-10"><div class="w-3 h-3 bg-pink-500 rounded-full"></div></div></div>`,
                        className: ''
                    });
                    L.marker(DEST_COORDS, { icon: homeIcon }).addTo(mapRef.current);

                    // ë¼ì´ë” ë§ˆì»¤
                    const riderIcon = L.divIcon({
                        html: `<div class="rider-emoji">ğŸ›µ</div>`,
                        className: ''
                    });
                    riderMarkerRef.current = L.marker(START_COORDS, { icon: riderIcon }).addTo(mapRef.current);
                }

                // ë¼ì´ë” ì´ë™ ì‹œë®¬ë ˆì´ì…˜ (ì„œë©´ì—­ ë°©í–¥ìœ¼ë¡œ)
                if (step === 1) {
                    let progress = 0;
                    const moveInterval = setInterval(() => {
                        progress += 0.005;
                        if (progress <= 1) {
                            const currentLat = START_COORDS[0] + (DEST_COORDS[0] - START_COORDS[0]) * progress;
                            const currentLng = START_COORDS[1] + (DEST_COORDS[1] - START_COORDS[1]) * progress;
                            riderMarkerRef.current.setLatLng([currentLat, currentLng]);
                        }
                    }, 1000);
                    return () => clearInterval(moveInterval);
                }
            }, [step]);

            const getArrivalLabel = () => {
                const now = new Date();
                now.setSeconds(now.getSeconds() + timeLeft);
                const hours = now.getHours() > 12 ? `ì˜¤í›„ ${now.getHours()-12}` : `ì˜¤ì „ ${now.getHours()}`;
                return `${hours}:${String(now.getMinutes()).padStart(2, '0')} ë„ì°© ì˜ˆì •`;
            };

            return (
                <div className="max-w-[480px] mx-auto bg-white min-h-screen shadow-xl relative flex flex-col">
                    {/* ìƒë‹¨ë°” */}
                    <header className="p-4 flex items-center border-b sticky top-0 bg-white z-[1001]">
                        <button className="p-1 text-gray-700"><svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M15 19l-7-7 7-7"></path></svg></button>
                        <h1 className="flex-1 text-center font-bold text-lg pr-8">ì£¼ë¬¸ í˜„í™©</h1>
                    </header>

                    {/* ìƒíƒœ ì •ë³´ */}
                    <section className="p-6">
                        <div className="flex justify-between items-start">
                            <div className="space-y-1">
                                <span className="inline-flex items-center px-2 py-0.5 rounded bg-gray-100 text-[11px] font-bold text-gray-600">ì‹¤ì†ë°°ë‹¬</span>
                                <h2 className="text-2xl font-black tracking-tight">{getArrivalLabel()}</h2>
                                <p className="text-gray-500 text-sm font-medium">
                                    {step === 0 ? "ì •ì„±ê» ìŒì‹ì„ ì¤€ë¹„í•˜ê³  ìˆì–´ìš”" : "ë¼ì´ë”ë‹˜ì´ ì„œë©´ì—­ ì¸ê·¼ì—ì„œ ì´ë™ ì¤‘ì…ë‹ˆë‹¤"}
                                </p>
                            </div>
                            <div className="w-14 h-14 bg-pink-50 rounded-2xl flex items-center justify-center text-3xl">
                                {step === 0 ? "ğŸ³" : "ğŸ›µ"}
                            </div>
                        </div>

                        {/* í”„ë¡œê·¸ë ˆìŠ¤ ìŠ¤í… */}
                        <div className="mt-8 flex items-center justify-between px-2">
                            {['ì£¼ë¬¸ì™„ë£Œ', 'ì¡°ë¦¬ì¤‘', 'ë°°ë‹¬ì¤‘', 'ì™„ë£Œ'].map((label, idx) => (
                                <div key={label} className="flex flex-col items-center gap-2 flex-1 relative">
                                    <div className={`status-dot z-10 ${step >= idx ? 'yogiyo-bg-pink scale-125' : 'bg-gray-200'}`}></div>
                                    <span className={`text-[10px] ${step >= idx ? 'text-pink-600 font-bold' : 'text-gray-400'}`}>{label}</span>
                                    {idx < 3 && (
                                        <div className={`absolute top-[3.5px] left-1/2 w-full h-[1.5px] ${step > idx ? 'yogiyo-bg-pink' : 'bg-gray-100'}`}></div>
                                    )}
                                </div>
                            ))}
                        </div>
                    </section>

                    {/* ì§€ë„ êµ¬ì—­ */}
                    <div className="relative border-y border-gray-100">
                        <div id="map"></div>
                        <div className="absolute bottom-4 left-4 z-[1000] bg-white px-4 py-2.5 rounded-xl shadow-lg border border-gray-100 text-xs font-extrabold flex items-center gap-2">
                            <span className="flex h-2 w-2 relative">
                                <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                                <span className="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
                            </span>
                            ì‹¤ì‹œê°„ ìœ„ì¹˜ ì¶”ì  ì¤‘
                        </div>
                    </div>

                    {/* ê°€ê²Œ ë° ì£¼ë¬¸ ì •ë³´ */}
                    <div className="p-5 flex-1">
                        <div className="flex justify-between items-center mb-6">
                            <h3 className="text-xl font-bold flex items-center gap-1">
                                ê³µì°¨ ë¶€ì‚°ì„œë©´ì 
                                <svg className="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M9 5l7 7-7 7"></path></svg>
                            </h3>
                            <button className="text-xs font-bold text-gray-500 bg-gray-100 px-3 py-1.5 rounded-lg">ì „í™”í•˜ê¸°</button>
                        </div>

                        <div className="bg-gray-50 rounded-2xl p-5 border border-gray-100">
                            <div className="flex justify-between items-start mb-4">
                                <div>
                                    <p className="font-bold text-gray-800">ë¯¸ë‹ˆí„ ë§ê³ ë°€í¬ J ì™¸ 1ê°œ</p>
                                    <p className="text-xs text-gray-500 mt-1">ë‹¹ë„ 50% / ì–¼ìŒ ë³´í†µ / í„ ì¶”ê°€</p>
                                </div>
                                <span className="font-bold">12,400ì›</span>
                            </div>
                            <div className="pt-4 border-t border-gray-200 space-y-2">
                                <div className="flex justify-between text-xs text-gray-500">
                                    <span>ë°°ë‹¬ë¹„</span>
                                    <span className="text-blue-600 font-bold">ë¬´ë£Œë°°ë‹¬ ì ìš©</span>
                                </div>
                                <div className="flex justify-between text-sm font-black pt-1">
                                    <span>ì´ ê²°ì œê¸ˆì•¡</span>
                                    <span className="text-pink-600 text-lg">10,800ì›</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* í•˜ë‹¨ ê³ ì • ì•¡ì…˜ ë²„íŠ¼ */}
                    <div className="p-4 grid grid-cols-2 gap-3 bg-white border-t sticky bottom-0 z-[1001]">
                        <button className="py-4 border-2 border-pink-500 text-pink-500 rounded-xl font-bold text-sm">ì¬ì£¼ë¬¸í•˜ê¸°</button>
                        <button 
                            onClick={() => setIsModalOpen(true)}
                            className="py-4 bg-gray-900 text-white rounded-xl font-bold text-sm"
                        >
                            ë¬¸ì˜í•˜ê¸°
                        </button>
                    </div>

                    {/* ë¬¸ì˜ ëª¨ë‹¬ */}
                    {isModalOpen && (
                        <div className="fixed inset-0 z-[2000] flex items-end justify-center bg-black/60 px-4 pb-8 backdrop-blur-sm">
                            <div className="bg-white w-full max-w-md rounded-[32px] p-8 animate-slide-up shadow-2xl">
                                <div className="w-12 h-1.5 bg-gray-200 rounded-full mx-auto mb-8"></div>
                                <h3 className="text-2xl font-black mb-6">ì–´ë–¤ ë„ì›€ì´<br/>í•„ìš”í•˜ì‹ ê°€ìš”?</h3>
                                <div className="grid grid-cols-1 gap-3">
                                    <button className="w-full text-left p-5 rounded-2xl bg-gray-50 hover:bg-gray-100 flex items-center justify-between group">
                                        <div>
                                            <p className="font-bold text-gray-800">ê°€ê²Œë¡œ ì§ì ‘ ì—°ë½</p>
                                            <p className="text-xs text-gray-500 mt-0.5 font-medium">ì¡°ë¦¬ ìƒíƒœë‚˜ ì˜µì…˜ ë³€ê²½ ë¬¸ì˜</p>
                                        </div>
                                        <div className="w-10 h-10 rounded-full bg-white flex items-center justify-center shadow-sm group-hover:bg-pink-500 group-hover:text-white transition-colors">ğŸ“</div>
                                    </button>
                                    <button className="w-full text-left p-5 rounded-2xl bg-gray-50 hover:bg-gray-100 flex items-center justify-between group">
                                        <div>
                                            <p className="font-bold text-gray-800">ê³ ê°ì„¼í„° ì±„íŒ…ìƒë‹´</p>
                                            <p className="text-xs text-gray-500 mt-0.5 font-medium">ë°°ë‹¬ ì§€ì—° ë° ê²°ì œ ë¬¸ì˜</p>
                                        </div>
                                        <div className="w-10 h-10 rounded-full bg-white flex items-center justify-center shadow-sm group-hover:bg-pink-500 group-hover:text-white transition-colors">ğŸ’¬</div>
                                    </button>
                                </div>
                                <button 
                                    onClick={() => setIsModalOpen(false)}
                                    className="w-full mt-8 py-4 bg-gray-100 text-gray-500 rounded-2xl font-bold"
                                >
                                    ë‹«ê¸°
                                </button>
                            </div>
                        </div>
                    )}

                    {/* ë°ëª¨ìš© ì œì–´ íŒ¨ë„ */}
                    <div className="fixed top-20 right-4 z-[2000] flex flex-col gap-2 scale-75 origin-right">
                        <button onClick={() => setStep(0)} className="bg-white/90 p-3 rounded-full shadow-lg font-bold text-xs border border-gray-200">ì¡°ë¦¬</button>
                        <button onClick={() => setStep(1)} className="bg-white/90 p-3 rounded-full shadow-lg font-bold text-xs border border-gray-200">ë°°ë‹¬</button>
                        <button onClick={() => setStep(3)} className="bg-white/90 p-3 rounded-full shadow-lg font-bold text-xs border border-gray-200 text-pink-500">ì™„ë£Œ</button>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<DeliveryApp />);
    </script>
</body>
</html>
